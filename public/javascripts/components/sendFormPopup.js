define(["jquery","components/popup"],function(e,s){"use strict";return compSupport.extend(s,{ENTER_CODE:13,init:function(n,o){var t=this;this.url=o.url,this.needRedirect=o.needRedirect,this.showSignInPopup=o.showSignInPopup,this.showNextPopup=o.showNextPopup,this.messageBox=".message-box",s.init.apply(this,arguments),compSupport.callFunc(e("#"+n).find("form"),"addAsyncValidator",[function(e){t.sendForm(function(){e.asyncValidatorFail()},function(){e.asyncValidatorPass()},t)}])},showMessage:function(e,s,n){var o=n||this.domId;o.find(this.messageBox).html('<div class="'+s+'-msg">'+e+"</div>")},clearMessage:function(){this.domId.find(this.messageBox).html("")},showSpinner:function(){this.domId.find('button[type="button"]').append('<object class="spinner" data="../images/svg/spinner.svg" type="image/svg+xml"></object>')},hideSpinner:function(){this.domId.find(".spinner").remove()},sendForm:function(s,n,o){var t=this,i=this.domId.find("form"),r=i.serialize();this.clearMessage(),i.valid()&&(this.showSpinner(),e.ajax({beforeSend:function(s){s.setRequestHeader("X-CSRF-Token",e('meta[name="csrf-token"]').attr("content"))},method:"POST",url:this.url,data:r}).done(function(i){t.hideSpinner(),"errors"===i.status?(t.showMessage(i.errors,"error"),s.call(o)):(t.needRedirect&&(window.location.href=i.redirect_to),t.showSignInPopup&&(compSupport.callFunc("#loginPopup","show"),t.showMessage(i.success,"success",e("#loginPopup"))),t.showNextPopup?(compSupport.callFunc(t.showNextPopup,"show"),e(t.showNextPopup).find(".generated-number").text(i.generatedBankNumber)):(t.showMessage(i.success,"success"),n.call(o)))}).fail(function(e){if(t.hideSpinner(),422===e.status){var s=JSON.parse(e.responseText);t.showMessage(s.errors,"error")}else t.showMessage(e.responseText,"error")}))}})});